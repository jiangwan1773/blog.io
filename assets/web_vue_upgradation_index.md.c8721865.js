import{_ as n,C as a,c as l,H as p,Q as o,o as e}from"./chunks/framework.87dd653a.js";const v=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"web/vue/upgradation/index.md","filePath":"web/vue/upgradation/index.md"}'),t={name:"web/vue/upgradation/index.md"},c=o(`<h2 id="配置文件" tabindex="-1">配置文件 <a class="header-anchor" href="#配置文件" aria-label="Permalink to &quot;配置文件&quot;">​</a></h2><div class="info custom-block"><p class="custom-block-title">vite.config.ts</p><details class="details custom-block"><summary>源代码</summary><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { defineConfig } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;vite&#39;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> vue </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;@vitejs/plugin-vue2&#39;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> vueJsx </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;@vitejs/plugin-vue2-jsx&#39;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> createSvgSpritePlugin </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;vite-plugin-svg-sprite&#39;</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">path</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;path&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> legacy </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;@vitejs/plugin-legacy&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">defineConfig</span><span style="color:#E1E4E8;">(({ </span><span style="color:#FFAB70;">mode</span><span style="color:#E1E4E8;"> }) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">configFile</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">\`./config/\${</span><span style="color:#E1E4E8;">mode</span><span style="color:#9ECBFF;">}.env.js\`</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">defineMap</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {}</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 解决vite不兼容p<wbr>rocess.env</span></span>
<span class="line"><span style="color:#E1E4E8;">    Object.</span><span style="color:#B392F0;">keys</span><span style="color:#E1E4E8;">(configFile).</span><span style="color:#B392F0;">forEach</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">key</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        defineMap[</span><span style="color:#9ECBFF;">\`p<wbr>rocess.env.\${</span><span style="color:#E1E4E8;">key</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">JSON</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">stringify</span><span style="color:#E1E4E8;">(configFile[key])</span></span>
<span class="line"><span style="color:#E1E4E8;">    })</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        build: {</span></span>
<span class="line"><span style="color:#E1E4E8;">            target: </span><span style="color:#9ECBFF;">&#39;es2015&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        },</span></span>
<span class="line"><span style="color:#E1E4E8;">        plugins: [</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">vue</span><span style="color:#E1E4E8;">(),</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">vueJsx</span><span style="color:#E1E4E8;">(), </span><span style="color:#6A737D;">// 兼容jsx语法</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">createSvgSpritePlugin</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">                symbolId: </span><span style="color:#9ECBFF;">&#39;icon-[name]&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">            }), </span><span style="color:#6A737D;">// 兼容svg图片</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">legacy</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">                targets: [</span><span style="color:#9ECBFF;">&#39;chrome &gt;= 65&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;edge &gt;= 79&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;safari &gt;= 11.1&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;firefox &gt;= 67&#39;</span><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#E1E4E8;">                ignoreBrowserslistConfig: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                renderLegacyChunks: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                additionalLegacyPolyfills: [</span><span style="color:#9ECBFF;">&#39;regenerator-runtime/runtime&#39;</span><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#E1E4E8;">                modernPolyfills: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">            }) </span><span style="color:#6A737D;">// 兼容部分老旧浏览器</span></span>
<span class="line"><span style="color:#E1E4E8;">        ],</span></span>
<span class="line"><span style="color:#E1E4E8;">        server: {</span></span>
<span class="line"><span style="color:#E1E4E8;">            host: </span><span style="color:#9ECBFF;">&#39;0.0.0.0&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">            port: </span><span style="color:#79B8FF;">9700</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">            open: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">//自动打开</span></span>
<span class="line"><span style="color:#E1E4E8;">            proxy: {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&#39;/web&#39;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    target: </span><span style="color:#9ECBFF;">&#39;http://www.dev.com&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">// 开发环境</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#6A737D;">// target: &#39;http://www.test.com&#39;, // 测试环境</span></span>
<span class="line"><span style="color:#E1E4E8;">                    changeOrigin: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        },</span></span>
<span class="line"><span style="color:#E1E4E8;">        define: defineMap,</span></span>
<span class="line"><span style="color:#E1E4E8;">        esbuild: {</span></span>
<span class="line"><span style="color:#E1E4E8;">            pure: [</span><span style="color:#9ECBFF;">&#39;console.log&#39;</span><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#E1E4E8;">            drop: [</span><span style="color:#9ECBFF;">&#39;debugger&#39;</span><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#E1E4E8;">            target: </span><span style="color:#9ECBFF;">&#39;es2015&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        },</span></span>
<span class="line"><span style="color:#E1E4E8;">        resolve: {</span></span>
<span class="line"><span style="color:#E1E4E8;">            alias: {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">&#39;@&#39;</span><span style="color:#E1E4E8;">: path.</span><span style="color:#B392F0;">resolve</span><span style="color:#E1E4E8;">(__dirname, </span><span style="color:#9ECBFF;">&#39;src&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">            },</span></span>
<span class="line"><span style="color:#E1E4E8;">            extensions: [</span><span style="color:#9ECBFF;">&#39;.vue&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;.mjs&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;.js&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;.ts&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;.jsx&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;.tsx&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;.json&#39;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { defineConfig } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;vite&#39;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> vue </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;@vitejs/plugin-vue2&#39;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> vueJsx </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;@vitejs/plugin-vue2-jsx&#39;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> createSvgSpritePlugin </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;vite-plugin-svg-sprite&#39;</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">path</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;path&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> legacy </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;@vitejs/plugin-legacy&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">defineConfig</span><span style="color:#24292E;">(({ </span><span style="color:#E36209;">mode</span><span style="color:#24292E;"> }) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">configFile</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">\`./config/\${</span><span style="color:#24292E;">mode</span><span style="color:#032F62;">}.env.js\`</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">defineMap</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {}</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 解决vite不兼容p<wbr>rocess.env</span></span>
<span class="line"><span style="color:#24292E;">    Object.</span><span style="color:#6F42C1;">keys</span><span style="color:#24292E;">(configFile).</span><span style="color:#6F42C1;">forEach</span><span style="color:#24292E;">(</span><span style="color:#E36209;">key</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        defineMap[</span><span style="color:#032F62;">\`p<wbr>rocess.env.\${</span><span style="color:#24292E;">key</span><span style="color:#032F62;">}\`</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">JSON</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">stringify</span><span style="color:#24292E;">(configFile[key])</span></span>
<span class="line"><span style="color:#24292E;">    })</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        build: {</span></span>
<span class="line"><span style="color:#24292E;">            target: </span><span style="color:#032F62;">&#39;es2015&#39;</span></span>
<span class="line"><span style="color:#24292E;">        },</span></span>
<span class="line"><span style="color:#24292E;">        plugins: [</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">vue</span><span style="color:#24292E;">(),</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">vueJsx</span><span style="color:#24292E;">(), </span><span style="color:#6A737D;">// 兼容jsx语法</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">createSvgSpritePlugin</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">                symbolId: </span><span style="color:#032F62;">&#39;icon-[name]&#39;</span></span>
<span class="line"><span style="color:#24292E;">            }), </span><span style="color:#6A737D;">// 兼容svg图片</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">legacy</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">                targets: [</span><span style="color:#032F62;">&#39;chrome &gt;= 65&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;edge &gt;= 79&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;safari &gt;= 11.1&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;firefox &gt;= 67&#39;</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">                ignoreBrowserslistConfig: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                renderLegacyChunks: </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                additionalLegacyPolyfills: [</span><span style="color:#032F62;">&#39;regenerator-runtime/runtime&#39;</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">                modernPolyfills: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">            }) </span><span style="color:#6A737D;">// 兼容部分老旧浏览器</span></span>
<span class="line"><span style="color:#24292E;">        ],</span></span>
<span class="line"><span style="color:#24292E;">        server: {</span></span>
<span class="line"><span style="color:#24292E;">            host: </span><span style="color:#032F62;">&#39;0.0.0.0&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">            port: </span><span style="color:#005CC5;">9700</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">            open: </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">//自动打开</span></span>
<span class="line"><span style="color:#24292E;">            proxy: {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&#39;/web&#39;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">                    target: </span><span style="color:#032F62;">&#39;http://www.dev.com&#39;</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">// 开发环境</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6A737D;">// target: &#39;http://www.test.com&#39;, // 测试环境</span></span>
<span class="line"><span style="color:#24292E;">                    changeOrigin: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">        },</span></span>
<span class="line"><span style="color:#24292E;">        define: defineMap,</span></span>
<span class="line"><span style="color:#24292E;">        esbuild: {</span></span>
<span class="line"><span style="color:#24292E;">            pure: [</span><span style="color:#032F62;">&#39;console.log&#39;</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">            drop: [</span><span style="color:#032F62;">&#39;debugger&#39;</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">            target: </span><span style="color:#032F62;">&#39;es2015&#39;</span></span>
<span class="line"><span style="color:#24292E;">        },</span></span>
<span class="line"><span style="color:#24292E;">        resolve: {</span></span>
<span class="line"><span style="color:#24292E;">            alias: {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">&#39;@&#39;</span><span style="color:#24292E;">: path.</span><span style="color:#6F42C1;">resolve</span><span style="color:#24292E;">(__dirname, </span><span style="color:#032F62;">&#39;src&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">            },</span></span>
<span class="line"><span style="color:#24292E;">            extensions: [</span><span style="color:#032F62;">&#39;.vue&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;.mjs&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;.js&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;.ts&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;.jsx&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;.tsx&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;.json&#39;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">})</span></span></code></pre></div></details></div><h2 id="升级结果" tabindex="-1">升级结果 <a class="header-anchor" href="#升级结果" aria-label="Permalink to &quot;升级结果&quot;">​</a></h2><div class="info custom-block"><p class="custom-block-title">提升</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">1.升级完成项目启动由约3min多减少约2s内</span></span>
<span class="line"><span style="color:#E1E4E8;">2.代码更新效果时间约10s减少到无感</span></span>
<span class="line"><span style="color:#E1E4E8;">3.代码包体积减少1</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">4以上</span></span>
<span class="line"><span style="color:#E1E4E8;">4.打包时间减少2</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">5左右</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">1.升级完成项目启动由约3min多减少约2s内</span></span>
<span class="line"><span style="color:#24292E;">2.代码更新效果时间约10s减少到无感</span></span>
<span class="line"><span style="color:#24292E;">3.代码包体积减少1</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">4以上</span></span>
<span class="line"><span style="color:#24292E;">4.打包时间减少2</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">5左右</span></span></code></pre></div></div><h2 id="升级流程" tabindex="-1">升级流程 <a class="header-anchor" href="#升级流程" aria-label="Permalink to &quot;升级流程&quot;">​</a></h2><div class="info custom-block"><p class="custom-block-title">一、安装依赖</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">npm install vue@</span><span style="color:#79B8FF;">2.7</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">14</span></span>
<span class="line"><span style="color:#E1E4E8;">npm install vite</span></span>
<span class="line"><span style="color:#E1E4E8;">npm install vite</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">plugin</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">vue2</span></span>
<span class="line"><span style="color:#E1E4E8;">npm install vite</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">plugin</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">svg</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">sprite</span></span>
<span class="line"><span style="color:#E1E4E8;">npm install vitejs</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">plugin</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">legacy</span></span>
<span class="line"><span style="color:#E1E4E8;">npm install </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">D</span><span style="color:#E1E4E8;"> sass</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">npm install vue@</span><span style="color:#005CC5;">2.7</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">14</span></span>
<span class="line"><span style="color:#24292E;">npm install vite</span></span>
<span class="line"><span style="color:#24292E;">npm install vite</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">plugin</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">vue2</span></span>
<span class="line"><span style="color:#24292E;">npm install vite</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">plugin</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">svg</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">sprite</span></span>
<span class="line"><span style="color:#24292E;">npm install vitejs</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">plugin</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">legacy</span></span>
<span class="line"><span style="color:#24292E;">npm install </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">D</span><span style="color:#24292E;"> sass</span></span></code></pre></div><table><thead><tr><th>plugin</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td>vue@2.7.14</td><td style="text-align:center;">vue2已经是最终版了，直接升级到2.7.14，这样才可以兼容vite同样<br>elementUI应该也是最终版了，建议升级最终版</td></tr><tr><td>vite</td><td style="text-align:center;">使用vite打包</td></tr><tr><td>vite-plugin-vue2</td><td style="text-align:center;">兼容vue2语法</td></tr><tr><td>vitejs/plugin-vue2-jsx</td><td style="text-align:center;">兼容vue2的jsx语法</td></tr><tr><td>vitejs/plugin-legacy</td><td style="text-align:center;">传统浏览器兼容</td></tr><tr><td>sass</td><td style="text-align:center;">vite打包需要安装sass，版本过低的sass需要升级sass版本</td></tr></tbody></table></div><div class="info custom-block"><p class="custom-block-title">二、修改打包命令</p><blockquote><p>package.json文件</p></blockquote><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#9ECBFF;">&quot;scripts&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">&quot;dev&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;vite --mode dev&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">&quot;build:dev&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;vite build --mode dev&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">&quot;build:test&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;vite build --mode test&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">},</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#032F62;">&quot;scripts&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">&quot;dev&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;vite --mode dev&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">&quot;build:dev&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;vite build --mode dev&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">&quot;build:test&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;vite build --mode test&quot;</span></span>
<span class="line"><span style="color:#24292E;">},</span></span></code></pre></div></div><div class="info custom-block"><p class="custom-block-title">三、修改vite打包入口</p><blockquote><p>index.html</p></blockquote><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">script</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">type</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;module&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">src</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;/src/index.js&quot;</span><span style="color:#E1E4E8;">&gt;&lt;/</span><span style="color:#85E89D;">script</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">script</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">type</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;module&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">src</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;/src/index.js&quot;</span><span style="color:#24292E;">&gt;&lt;/</span><span style="color:#22863A;">script</span><span style="color:#24292E;">&gt;</span></span></code></pre></div></div><div class="info custom-block"><p class="custom-block-title">四、根目录新建vite.config.ts文件</p><blockquote><p>顶部配置文件</p></blockquote></div><div class="info custom-block"><p class="custom-block-title">五、遇到的问题</p><blockquote><p>1.css的<code>/deep/</code></p></blockquote><div>vite打包css不可以使用sass的/deep/语法</div><div>全局替换成<span class="cp-span">::v-deep</span></div><blockquote><p>2.webpack中使用require引入文件</p></blockquote><div>vite中需要改成<span class="cp-span">import</span>引入</div><blockquote><p>3.svg字体图标的批量导入变更</p></blockquote><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">req</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> require.</span><span style="color:#B392F0;">context</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;./svg&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">,</span><span style="color:#DBEDFF;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#85E89D;font-weight:bold;">\\.</span><span style="color:#DBEDFF;">svg</span><span style="color:#F97583;">$</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">requireAll</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">requireContext</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> requireContext.</span><span style="color:#B392F0;">keys</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">map</span><span style="color:#E1E4E8;">(requireContext)</span></span>
<span class="line"><span style="color:#B392F0;">requireAll</span><span style="color:#E1E4E8;">(req)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">req</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> require.</span><span style="color:#6F42C1;">context</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;./svg&#39;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">,</span><span style="color:#032F62;"> /</span><span style="color:#22863A;font-weight:bold;">\\.</span><span style="color:#032F62;">svg</span><span style="color:#D73A49;">$</span><span style="color:#032F62;">/</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">requireAll</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#E36209;">requireContext</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> requireContext.</span><span style="color:#6F42C1;">keys</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">map</span><span style="color:#24292E;">(requireContext)</span></span>
<span class="line"><span style="color:#6F42C1;">requireAll</span><span style="color:#24292E;">(req)</span></span></code></pre></div><blockquote><p>4.盗版浏览器</p></blockquote><div>升级的项目是对外的，遇到了<span class="cp-span">2345浏览器非官网版本</span>白屏</div><div>报错<span class="cp-span-warn">Uncaught ReferenceError: globalThis is not defined</span></div><div>粗暴的解决方案（暂未有其他解决方案）</div><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 在index.html文件添加</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">script</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    if (globalThis === &#39;undefined&#39;) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        var globalThis </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> window</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">script</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 在index.html文件添加</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">script</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    if (globalThis === &#39;undefined&#39;) {</span></span>
<span class="line"><span style="color:#24292E;">        var globalThis </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> window</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">script</span><span style="color:#24292E;">&gt;</span></span></code></pre></div></div>`,10);function r(E,y,i,d,F,u){const s=a("c-title");return e(),l("div",null,[p(s,{title:"Vue2项目打包方式webpack升级vite"}),c])}const C=n(t,[["render",r]]);export{v as __pageData,C as default};
