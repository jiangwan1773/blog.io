import{m}from"./chunks/index.2a594c1f.js";import{_ as B,h as i,C as F,c as v,H as y,w as u,k as e,F as g,D as h,Q as _,o as r,a as d,t as b,e as j,p as I,m as k}from"./chunks/framework.3deaef37.js";const A=["jpg","jpeg","png","gif"],C=".jpg、.jpeg、.png、.gif";function x(){return new Promise((n,a)=>{w({multiple:!0,accept:"image/*",typeArr:A}).then(s=>{L(s,A)?n(s):(m.info(`上传文件类型需满足${C}`),a(`上传文件类型需满足${C}`))}).catch(s=>{a(s)})})}function w(n={}){return new Promise((a,s)=>{const l={accept:"*",typeArr:[],multiple:!1,size:10240,limit:5,...n},t=document.createElement("input");t.type="file",t.multiple=l.multiple,t.accept=l.accept,t.style.width="0",t.style.height="0",document.body.appendChild(t),t.click(),t.oninput=c=>{const p=[...c.target.files];T(p,l).then(()=>{a(p)}).catch(o=>{m.error(o),s(o)})},window.addEventListener("focus",()=>{setTimeout(()=>{t.value||(document.body.removeChild(t),s("用户取消上传"))},500)},{once:!0})})}function L(n,a=[]){const s=Array.from(n);let l=[];s.forEach(p=>{l.push(P(p))});const t=l.filter(p=>a.includes(p));return l.length===t.length}function P(n){var a;return(a=n.name.split(".")[n.name.split(".").length-1])==null?void 0:a.toLowerCase()}function T(n,a){return new Promise((s,l)=>{if(n.length>a.limit)return l(`上传数量超过${a.limit}个`);s("校验通过")})}const D=n=>(I("data-v-5733fa09"),n=n(),k(),n),$=D(()=>e("blockquote",null,[e("p",null,[d("Vue3 + ts函数式封装支持 "),e("code",null,"函数式｜组件"),d(" 两种使用方式")])],-1)),M=D(()=>e("h2",{id:"演示",tabindex:"-1"},[d("演示 "),e("a",{class:"header-anchor",href:"#演示","aria-label":'Permalink to "演示"'},"​")],-1)),V={class:"for-box"},S=["src"],G=_(`<h2 id="解释" tabindex="-1" data-v-5733fa09>解释 <a class="header-anchor" href="#解释" aria-label="Permalink to &quot;解释&quot;" data-v-5733fa09>​</a></h2><div class="info custom-block" data-v-5733fa09><p class="custom-block-title" data-v-5733fa09>一、全局挂载</p><div class="language-js vp-adaptive-theme" data-v-5733fa09><button title="Copy Code" class="copy" data-v-5733fa09></button><span class="lang" data-v-5733fa09>js</span><pre class="shiki github-dark vp-code-dark" data-v-5733fa09><code data-v-5733fa09><span class="line" data-v-5733fa09><span style="color:#6A737D;" data-v-5733fa09>// vue2全局挂载</span></span>
<span class="line" data-v-5733fa09><span style="color:#79B8FF;" data-v-5733fa09>Vue</span><span style="color:#E1E4E8;" data-v-5733fa09>.</span><span style="color:#79B8FF;" data-v-5733fa09>prototype</span><span style="color:#E1E4E8;" data-v-5733fa09>.$upload </span><span style="color:#F97583;" data-v-5733fa09>=</span><span style="color:#E1E4E8;" data-v-5733fa09> uploadImage</span></span>
<span class="line" data-v-5733fa09></span>
<span class="line" data-v-5733fa09><span style="color:#6A737D;" data-v-5733fa09>// vue3全局挂载</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>app.config.globalProperties.$upload </span><span style="color:#F97583;" data-v-5733fa09>=</span><span style="color:#E1E4E8;" data-v-5733fa09> uploadImage</span></span></code></pre><pre class="shiki github-light vp-code-light" data-v-5733fa09><code data-v-5733fa09><span class="line" data-v-5733fa09><span style="color:#6A737D;" data-v-5733fa09>// vue2全局挂载</span></span>
<span class="line" data-v-5733fa09><span style="color:#005CC5;" data-v-5733fa09>Vue</span><span style="color:#24292E;" data-v-5733fa09>.</span><span style="color:#005CC5;" data-v-5733fa09>prototype</span><span style="color:#24292E;" data-v-5733fa09>.$upload </span><span style="color:#D73A49;" data-v-5733fa09>=</span><span style="color:#24292E;" data-v-5733fa09> uploadImage</span></span>
<span class="line" data-v-5733fa09></span>
<span class="line" data-v-5733fa09><span style="color:#6A737D;" data-v-5733fa09>// vue3全局挂载</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>app.config.globalProperties.$upload </span><span style="color:#D73A49;" data-v-5733fa09>=</span><span style="color:#24292E;" data-v-5733fa09> uploadImage</span></span></code></pre></div></div><div class="info custom-block" data-v-5733fa09><p class="custom-block-title" data-v-5733fa09>二、使用</p><div class="language-js vp-adaptive-theme" data-v-5733fa09><button title="Copy Code" class="copy" data-v-5733fa09></button><span class="lang" data-v-5733fa09>js</span><pre class="shiki github-dark vp-code-dark" data-v-5733fa09><code data-v-5733fa09><span class="line" data-v-5733fa09><span style="color:#6A737D;" data-v-5733fa09>// vue2</span></span>
<span class="line" data-v-5733fa09><span style="color:#79B8FF;" data-v-5733fa09>this</span><span style="color:#E1E4E8;" data-v-5733fa09>.</span><span style="color:#B392F0;" data-v-5733fa09>$upload</span><span style="color:#E1E4E8;" data-v-5733fa09>().</span><span style="color:#B392F0;" data-v-5733fa09>then</span><span style="color:#E1E4E8;" data-v-5733fa09>(()</span><span style="color:#F97583;" data-v-5733fa09>=&gt;</span><span style="color:#E1E4E8;" data-v-5733fa09> {}).</span><span style="color:#B392F0;" data-v-5733fa09>catch</span><span style="color:#E1E4E8;" data-v-5733fa09>(</span><span style="color:#FFAB70;" data-v-5733fa09>err</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>=&gt;</span><span style="color:#E1E4E8;" data-v-5733fa09> {})</span></span>
<span class="line" data-v-5733fa09></span>
<span class="line" data-v-5733fa09><span style="color:#6A737D;" data-v-5733fa09>// vue3</span></span>
<span class="line" data-v-5733fa09><span style="color:#F97583;" data-v-5733fa09>&gt;</span><span style="color:#E1E4E8;" data-v-5733fa09> 必须使用proxy，正式环境ctx是获取不到的所以不能使用const { ctx } </span><span style="color:#F97583;" data-v-5733fa09>=</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#B392F0;" data-v-5733fa09>getCurrentInstance</span><span style="color:#E1E4E8;" data-v-5733fa09>()</span></span>
<span class="line" data-v-5733fa09><span style="color:#F97583;" data-v-5733fa09>const</span><span style="color:#E1E4E8;" data-v-5733fa09> { </span><span style="color:#79B8FF;" data-v-5733fa09>proxy</span><span style="color:#E1E4E8;" data-v-5733fa09> } </span><span style="color:#F97583;" data-v-5733fa09>=</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#B392F0;" data-v-5733fa09>getCurrentInstance</span><span style="color:#E1E4E8;" data-v-5733fa09>()</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>proxy.</span><span style="color:#B392F0;" data-v-5733fa09>$upload</span><span style="color:#E1E4E8;" data-v-5733fa09>().</span><span style="color:#B392F0;" data-v-5733fa09>then</span><span style="color:#E1E4E8;" data-v-5733fa09>(()</span><span style="color:#F97583;" data-v-5733fa09>=&gt;</span><span style="color:#E1E4E8;" data-v-5733fa09> {}).</span><span style="color:#B392F0;" data-v-5733fa09>catch</span><span style="color:#E1E4E8;" data-v-5733fa09>(</span><span style="color:#FFAB70;" data-v-5733fa09>err</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>=&gt;</span><span style="color:#E1E4E8;" data-v-5733fa09> {})</span></span></code></pre><pre class="shiki github-light vp-code-light" data-v-5733fa09><code data-v-5733fa09><span class="line" data-v-5733fa09><span style="color:#6A737D;" data-v-5733fa09>// vue2</span></span>
<span class="line" data-v-5733fa09><span style="color:#005CC5;" data-v-5733fa09>this</span><span style="color:#24292E;" data-v-5733fa09>.</span><span style="color:#6F42C1;" data-v-5733fa09>$upload</span><span style="color:#24292E;" data-v-5733fa09>().</span><span style="color:#6F42C1;" data-v-5733fa09>then</span><span style="color:#24292E;" data-v-5733fa09>(()</span><span style="color:#D73A49;" data-v-5733fa09>=&gt;</span><span style="color:#24292E;" data-v-5733fa09> {}).</span><span style="color:#6F42C1;" data-v-5733fa09>catch</span><span style="color:#24292E;" data-v-5733fa09>(</span><span style="color:#E36209;" data-v-5733fa09>err</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>=&gt;</span><span style="color:#24292E;" data-v-5733fa09> {})</span></span>
<span class="line" data-v-5733fa09></span>
<span class="line" data-v-5733fa09><span style="color:#6A737D;" data-v-5733fa09>// vue3</span></span>
<span class="line" data-v-5733fa09><span style="color:#D73A49;" data-v-5733fa09>&gt;</span><span style="color:#24292E;" data-v-5733fa09> 必须使用proxy，正式环境ctx是获取不到的所以不能使用const { ctx } </span><span style="color:#D73A49;" data-v-5733fa09>=</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#6F42C1;" data-v-5733fa09>getCurrentInstance</span><span style="color:#24292E;" data-v-5733fa09>()</span></span>
<span class="line" data-v-5733fa09><span style="color:#D73A49;" data-v-5733fa09>const</span><span style="color:#24292E;" data-v-5733fa09> { </span><span style="color:#005CC5;" data-v-5733fa09>proxy</span><span style="color:#24292E;" data-v-5733fa09> } </span><span style="color:#D73A49;" data-v-5733fa09>=</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#6F42C1;" data-v-5733fa09>getCurrentInstance</span><span style="color:#24292E;" data-v-5733fa09>()</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>proxy.</span><span style="color:#6F42C1;" data-v-5733fa09>$upload</span><span style="color:#24292E;" data-v-5733fa09>().</span><span style="color:#6F42C1;" data-v-5733fa09>then</span><span style="color:#24292E;" data-v-5733fa09>(()</span><span style="color:#D73A49;" data-v-5733fa09>=&gt;</span><span style="color:#24292E;" data-v-5733fa09> {}).</span><span style="color:#6F42C1;" data-v-5733fa09>catch</span><span style="color:#24292E;" data-v-5733fa09>(</span><span style="color:#E36209;" data-v-5733fa09>err</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>=&gt;</span><span style="color:#24292E;" data-v-5733fa09> {})</span></span></code></pre></div></div><details class="details custom-block" data-v-5733fa09><summary data-v-5733fa09>源代码</summary><div class="language-js vp-adaptive-theme" data-v-5733fa09><button title="Copy Code" class="copy" data-v-5733fa09></button><span class="lang" data-v-5733fa09>js</span><pre class="shiki github-dark vp-code-dark" data-v-5733fa09><code data-v-5733fa09><span class="line" data-v-5733fa09><span style="color:#F97583;" data-v-5733fa09>import</span><span style="color:#E1E4E8;" data-v-5733fa09> { message } </span><span style="color:#F97583;" data-v-5733fa09>from</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#9ECBFF;" data-v-5733fa09>&#39;ant-design-vue&#39;</span></span>
<span class="line" data-v-5733fa09></span>
<span class="line" data-v-5733fa09><span style="color:#F97583;" data-v-5733fa09>export</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>const</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#79B8FF;" data-v-5733fa09>IMAGE_TYPE</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>=</span><span style="color:#E1E4E8;" data-v-5733fa09> [</span><span style="color:#9ECBFF;" data-v-5733fa09>&#39;jpg&#39;</span><span style="color:#E1E4E8;" data-v-5733fa09>, </span><span style="color:#9ECBFF;" data-v-5733fa09>&#39;jpeg&#39;</span><span style="color:#E1E4E8;" data-v-5733fa09>, </span><span style="color:#9ECBFF;" data-v-5733fa09>&#39;png&#39;</span><span style="color:#E1E4E8;" data-v-5733fa09>, </span><span style="color:#9ECBFF;" data-v-5733fa09>&#39;gif&#39;</span><span style="color:#E1E4E8;" data-v-5733fa09>]</span></span>
<span class="line" data-v-5733fa09><span style="color:#F97583;" data-v-5733fa09>export</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>const</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#79B8FF;" data-v-5733fa09>typeMes</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>=</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#9ECBFF;" data-v-5733fa09>&#39;.jpg、.jpeg、.png、.gif&#39;</span></span>
<span class="line" data-v-5733fa09></span>
<span class="line" data-v-5733fa09><span style="color:#6A737D;" data-v-5733fa09>// 全局引入,二次封装，只限于上传图片</span></span>
<span class="line" data-v-5733fa09><span style="color:#F97583;" data-v-5733fa09>export</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>function</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#B392F0;" data-v-5733fa09>uploadImage</span><span style="color:#E1E4E8;" data-v-5733fa09>() {</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>    </span><span style="color:#F97583;" data-v-5733fa09>return</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>new</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#79B8FF;" data-v-5733fa09>Promise</span><span style="color:#E1E4E8;" data-v-5733fa09>((</span><span style="color:#FFAB70;" data-v-5733fa09>resolve</span><span style="color:#E1E4E8;" data-v-5733fa09>, </span><span style="color:#FFAB70;" data-v-5733fa09>reject</span><span style="color:#E1E4E8;" data-v-5733fa09>) </span><span style="color:#F97583;" data-v-5733fa09>=&gt;</span><span style="color:#E1E4E8;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>        </span><span style="color:#B392F0;" data-v-5733fa09>uploadWhole</span><span style="color:#E1E4E8;" data-v-5733fa09>({</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>            multiple: </span><span style="color:#79B8FF;" data-v-5733fa09>true</span><span style="color:#E1E4E8;" data-v-5733fa09>,</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>            accept: </span><span style="color:#9ECBFF;" data-v-5733fa09>&#39;image/*&#39;</span><span style="color:#E1E4E8;" data-v-5733fa09>,</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>            typeArr: </span><span style="color:#79B8FF;" data-v-5733fa09>IMAGE_TYPE</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>        })</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>            .</span><span style="color:#B392F0;" data-v-5733fa09>then</span><span style="color:#E1E4E8;" data-v-5733fa09>(</span><span style="color:#FFAB70;" data-v-5733fa09>fileList</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>=&gt;</span><span style="color:#E1E4E8;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>                </span><span style="color:#F97583;" data-v-5733fa09>if</span><span style="color:#E1E4E8;" data-v-5733fa09> (</span><span style="color:#B392F0;" data-v-5733fa09>judgeImage</span><span style="color:#E1E4E8;" data-v-5733fa09>(fileList, </span><span style="color:#79B8FF;" data-v-5733fa09>IMAGE_TYPE</span><span style="color:#E1E4E8;" data-v-5733fa09>)) {</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>                    </span><span style="color:#6A737D;" data-v-5733fa09>// 临时本地回显，后续调用阿里云对接第三方上传</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>                    </span><span style="color:#B392F0;" data-v-5733fa09>resolve</span><span style="color:#E1E4E8;" data-v-5733fa09>(fileList)</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>                } </span><span style="color:#F97583;" data-v-5733fa09>else</span><span style="color:#E1E4E8;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>                    message.</span><span style="color:#B392F0;" data-v-5733fa09>info</span><span style="color:#E1E4E8;" data-v-5733fa09>(</span><span style="color:#9ECBFF;" data-v-5733fa09>\`上传文件类型需满足\${</span><span style="color:#E1E4E8;" data-v-5733fa09>typeMes</span><span style="color:#9ECBFF;" data-v-5733fa09>}\`</span><span style="color:#E1E4E8;" data-v-5733fa09>)</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>                    </span><span style="color:#B392F0;" data-v-5733fa09>reject</span><span style="color:#E1E4E8;" data-v-5733fa09>(</span><span style="color:#9ECBFF;" data-v-5733fa09>\`上传文件类型需满足\${</span><span style="color:#E1E4E8;" data-v-5733fa09>typeMes</span><span style="color:#9ECBFF;" data-v-5733fa09>}\`</span><span style="color:#E1E4E8;" data-v-5733fa09>)</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>                }</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>            })</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>            .</span><span style="color:#B392F0;" data-v-5733fa09>catch</span><span style="color:#E1E4E8;" data-v-5733fa09>(</span><span style="color:#FFAB70;" data-v-5733fa09>err</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>=&gt;</span><span style="color:#E1E4E8;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>                </span><span style="color:#B392F0;" data-v-5733fa09>reject</span><span style="color:#E1E4E8;" data-v-5733fa09>(err)</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>            })</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>    })</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>}</span></span>
<span class="line" data-v-5733fa09></span>
<span class="line" data-v-5733fa09><span style="color:#6A737D;" data-v-5733fa09>// 核心：上传功能</span></span>
<span class="line" data-v-5733fa09><span style="color:#F97583;" data-v-5733fa09>export</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>function</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#B392F0;" data-v-5733fa09>uploadWhole</span><span style="color:#E1E4E8;" data-v-5733fa09>(</span><span style="color:#FFAB70;" data-v-5733fa09>options</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>=</span><span style="color:#E1E4E8;" data-v-5733fa09> {}) {</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>    </span><span style="color:#F97583;" data-v-5733fa09>return</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>new</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#79B8FF;" data-v-5733fa09>Promise</span><span style="color:#E1E4E8;" data-v-5733fa09>((</span><span style="color:#FFAB70;" data-v-5733fa09>resolve</span><span style="color:#E1E4E8;" data-v-5733fa09>, </span><span style="color:#FFAB70;" data-v-5733fa09>reject</span><span style="color:#E1E4E8;" data-v-5733fa09>) </span><span style="color:#F97583;" data-v-5733fa09>=&gt;</span><span style="color:#E1E4E8;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>        </span><span style="color:#F97583;" data-v-5733fa09>const</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#79B8FF;" data-v-5733fa09>config</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>=</span><span style="color:#E1E4E8;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>            accept: </span><span style="color:#9ECBFF;" data-v-5733fa09>&#39;*&#39;</span><span style="color:#E1E4E8;" data-v-5733fa09>, </span><span style="color:#6A737D;" data-v-5733fa09>// 接受的文件类型</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>            typeArr: [], </span><span style="color:#6A737D;" data-v-5733fa09>// 接受的文件类型，格式列表</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>            multiple: </span><span style="color:#79B8FF;" data-v-5733fa09>false</span><span style="color:#E1E4E8;" data-v-5733fa09>, </span><span style="color:#6A737D;" data-v-5733fa09>// 是否多选</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>            size: </span><span style="color:#79B8FF;" data-v-5733fa09>10240</span><span style="color:#E1E4E8;" data-v-5733fa09>, </span><span style="color:#6A737D;" data-v-5733fa09>// 文件大小限制，单位是kb</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>            limit: </span><span style="color:#79B8FF;" data-v-5733fa09>5</span><span style="color:#E1E4E8;" data-v-5733fa09>, </span><span style="color:#6A737D;" data-v-5733fa09>// 可选文件个数限制</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>            </span><span style="color:#F97583;" data-v-5733fa09>...</span><span style="color:#E1E4E8;" data-v-5733fa09>options</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>        }</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>        </span><span style="color:#F97583;" data-v-5733fa09>const</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#79B8FF;" data-v-5733fa09>input</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>=</span><span style="color:#E1E4E8;" data-v-5733fa09> document.</span><span style="color:#B392F0;" data-v-5733fa09>createElement</span><span style="color:#E1E4E8;" data-v-5733fa09>(</span><span style="color:#9ECBFF;" data-v-5733fa09>&#39;input&#39;</span><span style="color:#E1E4E8;" data-v-5733fa09>)</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>        input.type </span><span style="color:#F97583;" data-v-5733fa09>=</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#9ECBFF;" data-v-5733fa09>&#39;file&#39;</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>        input.multiple </span><span style="color:#F97583;" data-v-5733fa09>=</span><span style="color:#E1E4E8;" data-v-5733fa09> config.multiple</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>        input.accept </span><span style="color:#F97583;" data-v-5733fa09>=</span><span style="color:#E1E4E8;" data-v-5733fa09> config.accept</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>        input.style.width </span><span style="color:#F97583;" data-v-5733fa09>=</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#9ECBFF;" data-v-5733fa09>&#39;0&#39;</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>        input.style.height </span><span style="color:#F97583;" data-v-5733fa09>=</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#9ECBFF;" data-v-5733fa09>&#39;0&#39;</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>        document.body.</span><span style="color:#B392F0;" data-v-5733fa09>appendChild</span><span style="color:#E1E4E8;" data-v-5733fa09>(input)</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>        input.</span><span style="color:#B392F0;" data-v-5733fa09>click</span><span style="color:#E1E4E8;" data-v-5733fa09>()</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>        input.</span><span style="color:#B392F0;" data-v-5733fa09>oninput</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>=</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#FFAB70;" data-v-5733fa09>e</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>=&gt;</span><span style="color:#E1E4E8;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>            </span><span style="color:#6A737D;" data-v-5733fa09>// 必须做一次拷贝</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>            </span><span style="color:#F97583;" data-v-5733fa09>const</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#79B8FF;" data-v-5733fa09>list</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>=</span><span style="color:#E1E4E8;" data-v-5733fa09> [</span><span style="color:#F97583;" data-v-5733fa09>...</span><span style="color:#E1E4E8;" data-v-5733fa09>e.target.files]</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>            </span><span style="color:#B392F0;" data-v-5733fa09>check</span><span style="color:#E1E4E8;" data-v-5733fa09>(list, config)</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>                .</span><span style="color:#B392F0;" data-v-5733fa09>then</span><span style="color:#E1E4E8;" data-v-5733fa09>(() </span><span style="color:#F97583;" data-v-5733fa09>=&gt;</span><span style="color:#E1E4E8;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>                    </span><span style="color:#B392F0;" data-v-5733fa09>resolve</span><span style="color:#E1E4E8;" data-v-5733fa09>(list)</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>                })</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>                .</span><span style="color:#B392F0;" data-v-5733fa09>catch</span><span style="color:#E1E4E8;" data-v-5733fa09>(</span><span style="color:#FFAB70;" data-v-5733fa09>err</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>=&gt;</span><span style="color:#E1E4E8;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>                    message.</span><span style="color:#B392F0;" data-v-5733fa09>error</span><span style="color:#E1E4E8;" data-v-5733fa09>(err)</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>                    </span><span style="color:#B392F0;" data-v-5733fa09>reject</span><span style="color:#E1E4E8;" data-v-5733fa09>(err)</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>                })</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>        }</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>        window.</span><span style="color:#B392F0;" data-v-5733fa09>addEventListener</span><span style="color:#E1E4E8;" data-v-5733fa09>(</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>            </span><span style="color:#9ECBFF;" data-v-5733fa09>&#39;focus&#39;</span><span style="color:#E1E4E8;" data-v-5733fa09>,</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>            () </span><span style="color:#F97583;" data-v-5733fa09>=&gt;</span><span style="color:#E1E4E8;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>                </span><span style="color:#B392F0;" data-v-5733fa09>setTimeout</span><span style="color:#E1E4E8;" data-v-5733fa09>(() </span><span style="color:#F97583;" data-v-5733fa09>=&gt;</span><span style="color:#E1E4E8;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>                    </span><span style="color:#F97583;" data-v-5733fa09>if</span><span style="color:#E1E4E8;" data-v-5733fa09> (</span><span style="color:#F97583;" data-v-5733fa09>!</span><span style="color:#E1E4E8;" data-v-5733fa09>input.value) {</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>                        document.body.</span><span style="color:#B392F0;" data-v-5733fa09>removeChild</span><span style="color:#E1E4E8;" data-v-5733fa09>(input)</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>                        </span><span style="color:#B392F0;" data-v-5733fa09>reject</span><span style="color:#E1E4E8;" data-v-5733fa09>(</span><span style="color:#9ECBFF;" data-v-5733fa09>&#39;用户取消上传&#39;</span><span style="color:#E1E4E8;" data-v-5733fa09>)</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>                    }</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>                }, </span><span style="color:#79B8FF;" data-v-5733fa09>500</span><span style="color:#E1E4E8;" data-v-5733fa09>)</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>            },</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>            { once: </span><span style="color:#79B8FF;" data-v-5733fa09>true</span><span style="color:#E1E4E8;" data-v-5733fa09> }</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>        )</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>    })</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>}</span></span>
<span class="line" data-v-5733fa09></span>
<span class="line" data-v-5733fa09><span style="color:#6A737D;" data-v-5733fa09>// 判断是不是图片</span></span>
<span class="line" data-v-5733fa09><span style="color:#F97583;" data-v-5733fa09>function</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#B392F0;" data-v-5733fa09>judgeImage</span><span style="color:#E1E4E8;" data-v-5733fa09>(</span><span style="color:#FFAB70;" data-v-5733fa09>file</span><span style="color:#E1E4E8;" data-v-5733fa09>, </span><span style="color:#FFAB70;" data-v-5733fa09>typeList</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>=</span><span style="color:#E1E4E8;" data-v-5733fa09> []) {</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>    </span><span style="color:#6A737D;" data-v-5733fa09>// file：要判断的文件，typeList：非必需，上传文件类型数组</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>    </span><span style="color:#F97583;" data-v-5733fa09>const</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#79B8FF;" data-v-5733fa09>list</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>=</span><span style="color:#E1E4E8;" data-v-5733fa09> Array.</span><span style="color:#B392F0;" data-v-5733fa09>from</span><span style="color:#E1E4E8;" data-v-5733fa09>(file)</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>    </span><span style="color:#F97583;" data-v-5733fa09>let</span><span style="color:#E1E4E8;" data-v-5733fa09> arr </span><span style="color:#F97583;" data-v-5733fa09>=</span><span style="color:#E1E4E8;" data-v-5733fa09> []</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>    list.</span><span style="color:#B392F0;" data-v-5733fa09>forEach</span><span style="color:#E1E4E8;" data-v-5733fa09>(</span><span style="color:#FFAB70;" data-v-5733fa09>ele</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>=&gt;</span><span style="color:#E1E4E8;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>        arr.</span><span style="color:#B392F0;" data-v-5733fa09>push</span><span style="color:#E1E4E8;" data-v-5733fa09>(</span><span style="color:#B392F0;" data-v-5733fa09>filterImage</span><span style="color:#E1E4E8;" data-v-5733fa09>(ele))</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>    })</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>    </span><span style="color:#F97583;" data-v-5733fa09>const</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#79B8FF;" data-v-5733fa09>fileList</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>=</span><span style="color:#E1E4E8;" data-v-5733fa09> arr.</span><span style="color:#B392F0;" data-v-5733fa09>filter</span><span style="color:#E1E4E8;" data-v-5733fa09>(</span><span style="color:#FFAB70;" data-v-5733fa09>ele</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>=&gt;</span><span style="color:#E1E4E8;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>        </span><span style="color:#F97583;" data-v-5733fa09>return</span><span style="color:#E1E4E8;" data-v-5733fa09> typeList.</span><span style="color:#B392F0;" data-v-5733fa09>includes</span><span style="color:#E1E4E8;" data-v-5733fa09>(ele)</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>    })</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>    </span><span style="color:#F97583;" data-v-5733fa09>const</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#79B8FF;" data-v-5733fa09>ifT</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>=</span><span style="color:#E1E4E8;" data-v-5733fa09> arr.</span><span style="color:#79B8FF;" data-v-5733fa09>length</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>===</span><span style="color:#E1E4E8;" data-v-5733fa09> fileList.</span><span style="color:#79B8FF;" data-v-5733fa09>length</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>?</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#79B8FF;" data-v-5733fa09>true</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>:</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#79B8FF;" data-v-5733fa09>false</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>    </span><span style="color:#F97583;" data-v-5733fa09>return</span><span style="color:#E1E4E8;" data-v-5733fa09> ifT</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>}</span></span>
<span class="line" data-v-5733fa09></span>
<span class="line" data-v-5733fa09><span style="color:#6A737D;" data-v-5733fa09>// 获取文件类型</span></span>
<span class="line" data-v-5733fa09><span style="color:#F97583;" data-v-5733fa09>export</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>function</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#B392F0;" data-v-5733fa09>filterImage</span><span style="color:#E1E4E8;" data-v-5733fa09>(</span><span style="color:#FFAB70;" data-v-5733fa09>item</span><span style="color:#E1E4E8;" data-v-5733fa09>) {</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>    </span><span style="color:#F97583;" data-v-5733fa09>return</span><span style="color:#E1E4E8;" data-v-5733fa09> item.name.</span><span style="color:#B392F0;" data-v-5733fa09>split</span><span style="color:#E1E4E8;" data-v-5733fa09>(</span><span style="color:#9ECBFF;" data-v-5733fa09>&#39;.&#39;</span><span style="color:#E1E4E8;" data-v-5733fa09>)[item.name.</span><span style="color:#B392F0;" data-v-5733fa09>split</span><span style="color:#E1E4E8;" data-v-5733fa09>(</span><span style="color:#9ECBFF;" data-v-5733fa09>&#39;.&#39;</span><span style="color:#E1E4E8;" data-v-5733fa09>).</span><span style="color:#79B8FF;" data-v-5733fa09>length</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>-</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#79B8FF;" data-v-5733fa09>1</span><span style="color:#E1E4E8;" data-v-5733fa09>]?.</span><span style="color:#B392F0;" data-v-5733fa09>toLowerCase</span><span style="color:#E1E4E8;" data-v-5733fa09>()</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>}</span></span>
<span class="line" data-v-5733fa09></span>
<span class="line" data-v-5733fa09><span style="color:#6A737D;" data-v-5733fa09>// 校验</span></span>
<span class="line" data-v-5733fa09><span style="color:#F97583;" data-v-5733fa09>function</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#B392F0;" data-v-5733fa09>check</span><span style="color:#E1E4E8;" data-v-5733fa09>(</span><span style="color:#FFAB70;" data-v-5733fa09>list</span><span style="color:#E1E4E8;" data-v-5733fa09>, </span><span style="color:#FFAB70;" data-v-5733fa09>config</span><span style="color:#E1E4E8;" data-v-5733fa09>) {</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>    </span><span style="color:#F97583;" data-v-5733fa09>return</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>new</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#79B8FF;" data-v-5733fa09>Promise</span><span style="color:#E1E4E8;" data-v-5733fa09>((</span><span style="color:#FFAB70;" data-v-5733fa09>resolve</span><span style="color:#E1E4E8;" data-v-5733fa09>, </span><span style="color:#FFAB70;" data-v-5733fa09>reject</span><span style="color:#E1E4E8;" data-v-5733fa09>) </span><span style="color:#F97583;" data-v-5733fa09>=&gt;</span><span style="color:#E1E4E8;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>        </span><span style="color:#6A737D;" data-v-5733fa09>// 长度校验</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>        </span><span style="color:#F97583;" data-v-5733fa09>if</span><span style="color:#E1E4E8;" data-v-5733fa09> (list.</span><span style="color:#79B8FF;" data-v-5733fa09>length</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#F97583;" data-v-5733fa09>&gt;</span><span style="color:#E1E4E8;" data-v-5733fa09> config.limit) {</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>            </span><span style="color:#F97583;" data-v-5733fa09>return</span><span style="color:#E1E4E8;" data-v-5733fa09> </span><span style="color:#B392F0;" data-v-5733fa09>reject</span><span style="color:#E1E4E8;" data-v-5733fa09>(</span><span style="color:#9ECBFF;" data-v-5733fa09>\`上传数量超过\${</span><span style="color:#E1E4E8;" data-v-5733fa09>config</span><span style="color:#9ECBFF;" data-v-5733fa09>.</span><span style="color:#E1E4E8;" data-v-5733fa09>limit</span><span style="color:#9ECBFF;" data-v-5733fa09>}个\`</span><span style="color:#E1E4E8;" data-v-5733fa09>)</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>        }</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>        </span><span style="color:#6A737D;" data-v-5733fa09>// accept校验...</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>        </span><span style="color:#6A737D;" data-v-5733fa09>// size校验...</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>        </span><span style="color:#B392F0;" data-v-5733fa09>resolve</span><span style="color:#E1E4E8;" data-v-5733fa09>(</span><span style="color:#9ECBFF;" data-v-5733fa09>&#39;校验通过&#39;</span><span style="color:#E1E4E8;" data-v-5733fa09>)</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>    })</span></span>
<span class="line" data-v-5733fa09><span style="color:#E1E4E8;" data-v-5733fa09>}</span></span></code></pre><pre class="shiki github-light vp-code-light" data-v-5733fa09><code data-v-5733fa09><span class="line" data-v-5733fa09><span style="color:#D73A49;" data-v-5733fa09>import</span><span style="color:#24292E;" data-v-5733fa09> { message } </span><span style="color:#D73A49;" data-v-5733fa09>from</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#032F62;" data-v-5733fa09>&#39;ant-design-vue&#39;</span></span>
<span class="line" data-v-5733fa09></span>
<span class="line" data-v-5733fa09><span style="color:#D73A49;" data-v-5733fa09>export</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>const</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#005CC5;" data-v-5733fa09>IMAGE_TYPE</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>=</span><span style="color:#24292E;" data-v-5733fa09> [</span><span style="color:#032F62;" data-v-5733fa09>&#39;jpg&#39;</span><span style="color:#24292E;" data-v-5733fa09>, </span><span style="color:#032F62;" data-v-5733fa09>&#39;jpeg&#39;</span><span style="color:#24292E;" data-v-5733fa09>, </span><span style="color:#032F62;" data-v-5733fa09>&#39;png&#39;</span><span style="color:#24292E;" data-v-5733fa09>, </span><span style="color:#032F62;" data-v-5733fa09>&#39;gif&#39;</span><span style="color:#24292E;" data-v-5733fa09>]</span></span>
<span class="line" data-v-5733fa09><span style="color:#D73A49;" data-v-5733fa09>export</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>const</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#005CC5;" data-v-5733fa09>typeMes</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>=</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#032F62;" data-v-5733fa09>&#39;.jpg、.jpeg、.png、.gif&#39;</span></span>
<span class="line" data-v-5733fa09></span>
<span class="line" data-v-5733fa09><span style="color:#6A737D;" data-v-5733fa09>// 全局引入,二次封装，只限于上传图片</span></span>
<span class="line" data-v-5733fa09><span style="color:#D73A49;" data-v-5733fa09>export</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>function</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#6F42C1;" data-v-5733fa09>uploadImage</span><span style="color:#24292E;" data-v-5733fa09>() {</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>    </span><span style="color:#D73A49;" data-v-5733fa09>return</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>new</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#005CC5;" data-v-5733fa09>Promise</span><span style="color:#24292E;" data-v-5733fa09>((</span><span style="color:#E36209;" data-v-5733fa09>resolve</span><span style="color:#24292E;" data-v-5733fa09>, </span><span style="color:#E36209;" data-v-5733fa09>reject</span><span style="color:#24292E;" data-v-5733fa09>) </span><span style="color:#D73A49;" data-v-5733fa09>=&gt;</span><span style="color:#24292E;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>        </span><span style="color:#6F42C1;" data-v-5733fa09>uploadWhole</span><span style="color:#24292E;" data-v-5733fa09>({</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>            multiple: </span><span style="color:#005CC5;" data-v-5733fa09>true</span><span style="color:#24292E;" data-v-5733fa09>,</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>            accept: </span><span style="color:#032F62;" data-v-5733fa09>&#39;image/*&#39;</span><span style="color:#24292E;" data-v-5733fa09>,</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>            typeArr: </span><span style="color:#005CC5;" data-v-5733fa09>IMAGE_TYPE</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>        })</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>            .</span><span style="color:#6F42C1;" data-v-5733fa09>then</span><span style="color:#24292E;" data-v-5733fa09>(</span><span style="color:#E36209;" data-v-5733fa09>fileList</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>=&gt;</span><span style="color:#24292E;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>                </span><span style="color:#D73A49;" data-v-5733fa09>if</span><span style="color:#24292E;" data-v-5733fa09> (</span><span style="color:#6F42C1;" data-v-5733fa09>judgeImage</span><span style="color:#24292E;" data-v-5733fa09>(fileList, </span><span style="color:#005CC5;" data-v-5733fa09>IMAGE_TYPE</span><span style="color:#24292E;" data-v-5733fa09>)) {</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>                    </span><span style="color:#6A737D;" data-v-5733fa09>// 临时本地回显，后续调用阿里云对接第三方上传</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>                    </span><span style="color:#6F42C1;" data-v-5733fa09>resolve</span><span style="color:#24292E;" data-v-5733fa09>(fileList)</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>                } </span><span style="color:#D73A49;" data-v-5733fa09>else</span><span style="color:#24292E;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>                    message.</span><span style="color:#6F42C1;" data-v-5733fa09>info</span><span style="color:#24292E;" data-v-5733fa09>(</span><span style="color:#032F62;" data-v-5733fa09>\`上传文件类型需满足\${</span><span style="color:#24292E;" data-v-5733fa09>typeMes</span><span style="color:#032F62;" data-v-5733fa09>}\`</span><span style="color:#24292E;" data-v-5733fa09>)</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>                    </span><span style="color:#6F42C1;" data-v-5733fa09>reject</span><span style="color:#24292E;" data-v-5733fa09>(</span><span style="color:#032F62;" data-v-5733fa09>\`上传文件类型需满足\${</span><span style="color:#24292E;" data-v-5733fa09>typeMes</span><span style="color:#032F62;" data-v-5733fa09>}\`</span><span style="color:#24292E;" data-v-5733fa09>)</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>                }</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>            })</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>            .</span><span style="color:#6F42C1;" data-v-5733fa09>catch</span><span style="color:#24292E;" data-v-5733fa09>(</span><span style="color:#E36209;" data-v-5733fa09>err</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>=&gt;</span><span style="color:#24292E;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>                </span><span style="color:#6F42C1;" data-v-5733fa09>reject</span><span style="color:#24292E;" data-v-5733fa09>(err)</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>            })</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>    })</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>}</span></span>
<span class="line" data-v-5733fa09></span>
<span class="line" data-v-5733fa09><span style="color:#6A737D;" data-v-5733fa09>// 核心：上传功能</span></span>
<span class="line" data-v-5733fa09><span style="color:#D73A49;" data-v-5733fa09>export</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>function</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#6F42C1;" data-v-5733fa09>uploadWhole</span><span style="color:#24292E;" data-v-5733fa09>(</span><span style="color:#E36209;" data-v-5733fa09>options</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>=</span><span style="color:#24292E;" data-v-5733fa09> {}) {</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>    </span><span style="color:#D73A49;" data-v-5733fa09>return</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>new</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#005CC5;" data-v-5733fa09>Promise</span><span style="color:#24292E;" data-v-5733fa09>((</span><span style="color:#E36209;" data-v-5733fa09>resolve</span><span style="color:#24292E;" data-v-5733fa09>, </span><span style="color:#E36209;" data-v-5733fa09>reject</span><span style="color:#24292E;" data-v-5733fa09>) </span><span style="color:#D73A49;" data-v-5733fa09>=&gt;</span><span style="color:#24292E;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>        </span><span style="color:#D73A49;" data-v-5733fa09>const</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#005CC5;" data-v-5733fa09>config</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>=</span><span style="color:#24292E;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>            accept: </span><span style="color:#032F62;" data-v-5733fa09>&#39;*&#39;</span><span style="color:#24292E;" data-v-5733fa09>, </span><span style="color:#6A737D;" data-v-5733fa09>// 接受的文件类型</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>            typeArr: [], </span><span style="color:#6A737D;" data-v-5733fa09>// 接受的文件类型，格式列表</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>            multiple: </span><span style="color:#005CC5;" data-v-5733fa09>false</span><span style="color:#24292E;" data-v-5733fa09>, </span><span style="color:#6A737D;" data-v-5733fa09>// 是否多选</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>            size: </span><span style="color:#005CC5;" data-v-5733fa09>10240</span><span style="color:#24292E;" data-v-5733fa09>, </span><span style="color:#6A737D;" data-v-5733fa09>// 文件大小限制，单位是kb</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>            limit: </span><span style="color:#005CC5;" data-v-5733fa09>5</span><span style="color:#24292E;" data-v-5733fa09>, </span><span style="color:#6A737D;" data-v-5733fa09>// 可选文件个数限制</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>            </span><span style="color:#D73A49;" data-v-5733fa09>...</span><span style="color:#24292E;" data-v-5733fa09>options</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>        }</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>        </span><span style="color:#D73A49;" data-v-5733fa09>const</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#005CC5;" data-v-5733fa09>input</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>=</span><span style="color:#24292E;" data-v-5733fa09> document.</span><span style="color:#6F42C1;" data-v-5733fa09>createElement</span><span style="color:#24292E;" data-v-5733fa09>(</span><span style="color:#032F62;" data-v-5733fa09>&#39;input&#39;</span><span style="color:#24292E;" data-v-5733fa09>)</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>        input.type </span><span style="color:#D73A49;" data-v-5733fa09>=</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#032F62;" data-v-5733fa09>&#39;file&#39;</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>        input.multiple </span><span style="color:#D73A49;" data-v-5733fa09>=</span><span style="color:#24292E;" data-v-5733fa09> config.multiple</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>        input.accept </span><span style="color:#D73A49;" data-v-5733fa09>=</span><span style="color:#24292E;" data-v-5733fa09> config.accept</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>        input.style.width </span><span style="color:#D73A49;" data-v-5733fa09>=</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#032F62;" data-v-5733fa09>&#39;0&#39;</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>        input.style.height </span><span style="color:#D73A49;" data-v-5733fa09>=</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#032F62;" data-v-5733fa09>&#39;0&#39;</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>        document.body.</span><span style="color:#6F42C1;" data-v-5733fa09>appendChild</span><span style="color:#24292E;" data-v-5733fa09>(input)</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>        input.</span><span style="color:#6F42C1;" data-v-5733fa09>click</span><span style="color:#24292E;" data-v-5733fa09>()</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>        input.</span><span style="color:#6F42C1;" data-v-5733fa09>oninput</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>=</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#E36209;" data-v-5733fa09>e</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>=&gt;</span><span style="color:#24292E;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>            </span><span style="color:#6A737D;" data-v-5733fa09>// 必须做一次拷贝</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>            </span><span style="color:#D73A49;" data-v-5733fa09>const</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#005CC5;" data-v-5733fa09>list</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>=</span><span style="color:#24292E;" data-v-5733fa09> [</span><span style="color:#D73A49;" data-v-5733fa09>...</span><span style="color:#24292E;" data-v-5733fa09>e.target.files]</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>            </span><span style="color:#6F42C1;" data-v-5733fa09>check</span><span style="color:#24292E;" data-v-5733fa09>(list, config)</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>                .</span><span style="color:#6F42C1;" data-v-5733fa09>then</span><span style="color:#24292E;" data-v-5733fa09>(() </span><span style="color:#D73A49;" data-v-5733fa09>=&gt;</span><span style="color:#24292E;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>                    </span><span style="color:#6F42C1;" data-v-5733fa09>resolve</span><span style="color:#24292E;" data-v-5733fa09>(list)</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>                })</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>                .</span><span style="color:#6F42C1;" data-v-5733fa09>catch</span><span style="color:#24292E;" data-v-5733fa09>(</span><span style="color:#E36209;" data-v-5733fa09>err</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>=&gt;</span><span style="color:#24292E;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>                    message.</span><span style="color:#6F42C1;" data-v-5733fa09>error</span><span style="color:#24292E;" data-v-5733fa09>(err)</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>                    </span><span style="color:#6F42C1;" data-v-5733fa09>reject</span><span style="color:#24292E;" data-v-5733fa09>(err)</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>                })</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>        }</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>        window.</span><span style="color:#6F42C1;" data-v-5733fa09>addEventListener</span><span style="color:#24292E;" data-v-5733fa09>(</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>            </span><span style="color:#032F62;" data-v-5733fa09>&#39;focus&#39;</span><span style="color:#24292E;" data-v-5733fa09>,</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>            () </span><span style="color:#D73A49;" data-v-5733fa09>=&gt;</span><span style="color:#24292E;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>                </span><span style="color:#6F42C1;" data-v-5733fa09>setTimeout</span><span style="color:#24292E;" data-v-5733fa09>(() </span><span style="color:#D73A49;" data-v-5733fa09>=&gt;</span><span style="color:#24292E;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>                    </span><span style="color:#D73A49;" data-v-5733fa09>if</span><span style="color:#24292E;" data-v-5733fa09> (</span><span style="color:#D73A49;" data-v-5733fa09>!</span><span style="color:#24292E;" data-v-5733fa09>input.value) {</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>                        document.body.</span><span style="color:#6F42C1;" data-v-5733fa09>removeChild</span><span style="color:#24292E;" data-v-5733fa09>(input)</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>                        </span><span style="color:#6F42C1;" data-v-5733fa09>reject</span><span style="color:#24292E;" data-v-5733fa09>(</span><span style="color:#032F62;" data-v-5733fa09>&#39;用户取消上传&#39;</span><span style="color:#24292E;" data-v-5733fa09>)</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>                    }</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>                }, </span><span style="color:#005CC5;" data-v-5733fa09>500</span><span style="color:#24292E;" data-v-5733fa09>)</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>            },</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>            { once: </span><span style="color:#005CC5;" data-v-5733fa09>true</span><span style="color:#24292E;" data-v-5733fa09> }</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>        )</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>    })</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>}</span></span>
<span class="line" data-v-5733fa09></span>
<span class="line" data-v-5733fa09><span style="color:#6A737D;" data-v-5733fa09>// 判断是不是图片</span></span>
<span class="line" data-v-5733fa09><span style="color:#D73A49;" data-v-5733fa09>function</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#6F42C1;" data-v-5733fa09>judgeImage</span><span style="color:#24292E;" data-v-5733fa09>(</span><span style="color:#E36209;" data-v-5733fa09>file</span><span style="color:#24292E;" data-v-5733fa09>, </span><span style="color:#E36209;" data-v-5733fa09>typeList</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>=</span><span style="color:#24292E;" data-v-5733fa09> []) {</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>    </span><span style="color:#6A737D;" data-v-5733fa09>// file：要判断的文件，typeList：非必需，上传文件类型数组</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>    </span><span style="color:#D73A49;" data-v-5733fa09>const</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#005CC5;" data-v-5733fa09>list</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>=</span><span style="color:#24292E;" data-v-5733fa09> Array.</span><span style="color:#6F42C1;" data-v-5733fa09>from</span><span style="color:#24292E;" data-v-5733fa09>(file)</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>    </span><span style="color:#D73A49;" data-v-5733fa09>let</span><span style="color:#24292E;" data-v-5733fa09> arr </span><span style="color:#D73A49;" data-v-5733fa09>=</span><span style="color:#24292E;" data-v-5733fa09> []</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>    list.</span><span style="color:#6F42C1;" data-v-5733fa09>forEach</span><span style="color:#24292E;" data-v-5733fa09>(</span><span style="color:#E36209;" data-v-5733fa09>ele</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>=&gt;</span><span style="color:#24292E;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>        arr.</span><span style="color:#6F42C1;" data-v-5733fa09>push</span><span style="color:#24292E;" data-v-5733fa09>(</span><span style="color:#6F42C1;" data-v-5733fa09>filterImage</span><span style="color:#24292E;" data-v-5733fa09>(ele))</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>    })</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>    </span><span style="color:#D73A49;" data-v-5733fa09>const</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#005CC5;" data-v-5733fa09>fileList</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>=</span><span style="color:#24292E;" data-v-5733fa09> arr.</span><span style="color:#6F42C1;" data-v-5733fa09>filter</span><span style="color:#24292E;" data-v-5733fa09>(</span><span style="color:#E36209;" data-v-5733fa09>ele</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>=&gt;</span><span style="color:#24292E;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>        </span><span style="color:#D73A49;" data-v-5733fa09>return</span><span style="color:#24292E;" data-v-5733fa09> typeList.</span><span style="color:#6F42C1;" data-v-5733fa09>includes</span><span style="color:#24292E;" data-v-5733fa09>(ele)</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>    })</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>    </span><span style="color:#D73A49;" data-v-5733fa09>const</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#005CC5;" data-v-5733fa09>ifT</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>=</span><span style="color:#24292E;" data-v-5733fa09> arr.</span><span style="color:#005CC5;" data-v-5733fa09>length</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>===</span><span style="color:#24292E;" data-v-5733fa09> fileList.</span><span style="color:#005CC5;" data-v-5733fa09>length</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>?</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#005CC5;" data-v-5733fa09>true</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>:</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#005CC5;" data-v-5733fa09>false</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>    </span><span style="color:#D73A49;" data-v-5733fa09>return</span><span style="color:#24292E;" data-v-5733fa09> ifT</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>}</span></span>
<span class="line" data-v-5733fa09></span>
<span class="line" data-v-5733fa09><span style="color:#6A737D;" data-v-5733fa09>// 获取文件类型</span></span>
<span class="line" data-v-5733fa09><span style="color:#D73A49;" data-v-5733fa09>export</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>function</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#6F42C1;" data-v-5733fa09>filterImage</span><span style="color:#24292E;" data-v-5733fa09>(</span><span style="color:#E36209;" data-v-5733fa09>item</span><span style="color:#24292E;" data-v-5733fa09>) {</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>    </span><span style="color:#D73A49;" data-v-5733fa09>return</span><span style="color:#24292E;" data-v-5733fa09> item.name.</span><span style="color:#6F42C1;" data-v-5733fa09>split</span><span style="color:#24292E;" data-v-5733fa09>(</span><span style="color:#032F62;" data-v-5733fa09>&#39;.&#39;</span><span style="color:#24292E;" data-v-5733fa09>)[item.name.</span><span style="color:#6F42C1;" data-v-5733fa09>split</span><span style="color:#24292E;" data-v-5733fa09>(</span><span style="color:#032F62;" data-v-5733fa09>&#39;.&#39;</span><span style="color:#24292E;" data-v-5733fa09>).</span><span style="color:#005CC5;" data-v-5733fa09>length</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>-</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#005CC5;" data-v-5733fa09>1</span><span style="color:#24292E;" data-v-5733fa09>]?.</span><span style="color:#6F42C1;" data-v-5733fa09>toLowerCase</span><span style="color:#24292E;" data-v-5733fa09>()</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>}</span></span>
<span class="line" data-v-5733fa09></span>
<span class="line" data-v-5733fa09><span style="color:#6A737D;" data-v-5733fa09>// 校验</span></span>
<span class="line" data-v-5733fa09><span style="color:#D73A49;" data-v-5733fa09>function</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#6F42C1;" data-v-5733fa09>check</span><span style="color:#24292E;" data-v-5733fa09>(</span><span style="color:#E36209;" data-v-5733fa09>list</span><span style="color:#24292E;" data-v-5733fa09>, </span><span style="color:#E36209;" data-v-5733fa09>config</span><span style="color:#24292E;" data-v-5733fa09>) {</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>    </span><span style="color:#D73A49;" data-v-5733fa09>return</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>new</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#005CC5;" data-v-5733fa09>Promise</span><span style="color:#24292E;" data-v-5733fa09>((</span><span style="color:#E36209;" data-v-5733fa09>resolve</span><span style="color:#24292E;" data-v-5733fa09>, </span><span style="color:#E36209;" data-v-5733fa09>reject</span><span style="color:#24292E;" data-v-5733fa09>) </span><span style="color:#D73A49;" data-v-5733fa09>=&gt;</span><span style="color:#24292E;" data-v-5733fa09> {</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>        </span><span style="color:#6A737D;" data-v-5733fa09>// 长度校验</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>        </span><span style="color:#D73A49;" data-v-5733fa09>if</span><span style="color:#24292E;" data-v-5733fa09> (list.</span><span style="color:#005CC5;" data-v-5733fa09>length</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#D73A49;" data-v-5733fa09>&gt;</span><span style="color:#24292E;" data-v-5733fa09> config.limit) {</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>            </span><span style="color:#D73A49;" data-v-5733fa09>return</span><span style="color:#24292E;" data-v-5733fa09> </span><span style="color:#6F42C1;" data-v-5733fa09>reject</span><span style="color:#24292E;" data-v-5733fa09>(</span><span style="color:#032F62;" data-v-5733fa09>\`上传数量超过\${</span><span style="color:#24292E;" data-v-5733fa09>config</span><span style="color:#032F62;" data-v-5733fa09>.</span><span style="color:#24292E;" data-v-5733fa09>limit</span><span style="color:#032F62;" data-v-5733fa09>}个\`</span><span style="color:#24292E;" data-v-5733fa09>)</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>        }</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>        </span><span style="color:#6A737D;" data-v-5733fa09>// accept校验...</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>        </span><span style="color:#6A737D;" data-v-5733fa09>// size校验...</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>        </span><span style="color:#6F42C1;" data-v-5733fa09>resolve</span><span style="color:#24292E;" data-v-5733fa09>(</span><span style="color:#032F62;" data-v-5733fa09>&#39;校验通过&#39;</span><span style="color:#24292E;" data-v-5733fa09>)</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>    })</span></span>
<span class="line" data-v-5733fa09><span style="color:#24292E;" data-v-5733fa09>}</span></span></code></pre></div></details>`,4),q=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"web/vue/uploadImage/index.md","filePath":"web/vue/uploadImage/index.md"}'),N={name:"web/vue/uploadImage/index.md"},Y=Object.assign(N,{setup(n){const a=i([]),s=i(!1);function l(){s.value=!0,x().then(c=>{const p=[];c.forEach(o=>{const f=URL.createObjectURL(o);p.push(f)}),a.value=[...a.value,...p]}).finally(()=>{s.value=!1})}function t(){a.value.length=0}return(c,p)=>{const o=F("c-title"),f=F("a-button");return r(),v("div",null,[y(o,{title:"函数式封装上传图片组件"}),$,M,y(f,{type:"primary",onClick:l,loading:s.value,style:{"margin-right":"10px"}},{default:u(()=>[d(b(s.value?"上传中...":"上传"),1)]),_:1},8,["loading"]),y(f,{type:"primary",onClick:t},{default:u(()=>[d("清空图片")]),_:1}),e("div",V,[(r(!0),v(g,null,h(a.value,E=>(r(),v(g,{key:E},[E?(r(),v("img",{key:0,src:E,class:"show-img"},null,8,S)):j("",!0)],64))),128))]),G])}}}),O=B(Y,[["__scopeId","data-v-5733fa09"]]);export{q as __pageData,O as default};
